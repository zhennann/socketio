!function(s,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.socketio=e():s.socketio=e()}(self,(function(){return(()=>{"use strict";var s={d:(e,i)=>{for(var t in i)s.o(i,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:i[t]})},o:(s,e)=>Object.prototype.hasOwnProperty.call(s,e),r:s=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})}},e={};function i(s,e){var i="undefined"!=typeof Symbol&&s[Symbol.iterator]||s["@@iterator"];if(!i){if(Array.isArray(s)||(i=function(s,e){if(s){if("string"==typeof s)return t(s,e);var i=Object.prototype.toString.call(s).slice(8,-1);return"Object"===i&&s.constructor&&(i=s.constructor.name),"Map"===i||"Set"===i?Array.from(s):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?t(s,e):void 0}}(s))||e&&s&&"number"==typeof s.length){i&&(s=i);var n=0,o=function(){};return{s:o,n:function(){return n>=s.length?{done:!0}:{done:!1,value:s[n++]}},e:function(s){throw s},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,r=!0,u=!1;return{s:function(){i=i.call(s)},n:function(){var s=i.next();return r=s.done,s},e:function(s){u=!0,c=s},f:function(){try{r||null==i.return||i.return()}finally{if(u)throw c}}}}function t(s,e){(null==e||e>s.length)&&(e=s.length);for(var i=0,t=new Array(e);i<e;i++)t[i]=s[i];return t}s.r(e),s.d(e,{default:()=>n});const n=function(s){var e={_socket:null,_subscribeCounter:0,_subscribesAll:{},_subscribesPath:{},_subscribesWaitingTimeoutId:0,_subscribesWaitingDoing:!1,_subscribesWaiting:{},_unsubscribesWaitingTimeoutId:0,_unsubscribesWaitingDoing:!1,_unsubscribesWaiting:{},subscribe:function(s,e,i,t){t=t||{};var n=this._getSocket();n.connected||n.connect();var o=++this._subscribeCounter;this._subscribesAll[o]={path:s,cbMessage:e,cbSubscribed:i,options:t};var c=this._subscribesPath[s],r=!1;return c||(c=this._subscribesPath[s]={scene:t.scene,items:{}},r=!0,delete this._unsubscribesWaiting[s]),c.items[o]=!0,n.connected&&(r?(this._subscribesWaiting[s]=!0,this._doSubscribesWaiting()):this._subscribesWaiting[s]||i&&i()),o},unsubscribe:function(s){var e=this._subscribesAll[s];if(e){var i=this._subscribesPath[e.path];i&&(delete i.items[s],0===Object.keys(i.items).length&&(delete this._subscribesPath[e.path],delete this._subscribesWaiting[e.path],i.socketId&&(this._unsubscribesWaiting[e.path]={scene:i.scene,socketId:i.socketId},this._doUnsubscribesWaiting()))),delete this._subscribesAll[s],0===Object.keys(this._subscribesAll).length&&this.disconnect()}},_doSubscribesWaiting:function(){var e=this;if(!this._subscribesWaitingDoing&&0===this._subscribesWaitingTimeoutId&&0!==Object.keys(this._subscribesWaiting).length&&this._socket.connected){var t=[];for(var n in this._subscribesWaiting){var o=this._subscribesPath[n];o&&t.push({path:n,scene:o.scene})}this._subscribesWaitingDoing=!0,s.subscribe({subscribes:t,socketId:this._socket.id}).then((function(){var s,n=i(t);try{for(n.s();!(s=n.n()).done;){var o=s.value;delete e._subscribesWaiting[o.path];var c=e._subscribesPath[o.path];if(c)for(var r in c.socketId=e._socket.id,c.items){var u=e._subscribesAll[r];u&&u.cbSubscribed&&u.cbSubscribed()}}}catch(s){n.e(s)}finally{n.f()}e._subscribesWaitingDoing=!1,e._doSubscribesWaiting()})).catch((function(s){e._subscribesWaitingDoing=!1,401===s.code?e._logout():e._subscribesWaitingTimeoutId=setTimeout((function(){e._subscribesWaitingTimeoutId=0,e._doSubscribesWaiting()}),2e3)}))}},_doUnsubscribesWaiting:function(){var e=this;if(!this._unsubscribesWaitingDoing&&0===this._unsubscribesWaitingTimeoutId&&0!==Object.keys(this._unsubscribesWaiting).length){var t=[];for(var n in this._unsubscribesWaiting)if(this._subscribesPath[n])delete this._unsubscribesWaiting[n];else{var o=this._unsubscribesWaiting[n];t.push({path:n,scene:o.scene,socketId:o.socketId})}this._unsubscribesWaitingDoing=!0,s.unsubscribe({subscribes:t}).then((function(){var s,n=i(t);try{for(n.s();!(s=n.n()).done;){var o=s.value;delete e._unsubscribesWaiting[o.path]}}catch(s){n.e(s)}finally{n.f()}e._unsubscribesWaitingDoing=!1,e._doUnsubscribesWaiting()})).catch((function(s){e._unsubscribesWaitingDoing=!1,401===s.code?e._logout():e._unsubscribesWaitingTimeoutId=setTimeout((function(){e._unsubscribesWaitingTimeoutId=0,e._doUnsubscribesWaiting()}),2e3)}))}},_getSocket:function(){return this._socket||(this._socket=s.socket(),this._socket.on("connect",this._onConnectBind),this._socket.on("disconnect",this._onDisconnectBind),this._socket.on("message",this._onMessageBind),this._socket.on("message-system",this._onMessageSystemBind)),this._socket},_logout:function(){var e=this;setTimeout((function(){e.disconnect(),s.logout&&s.logout()}),0)},_onMessage:function(s){var e=this._subscribesPath[s.path];if(e)for(var i in e.items){var t=this._subscribesAll[i];t&&t.cbMessage&&t.cbMessage({message:s.message})}},_onMessageSystem:function(s){401===s.code&&this._onMessageSystem_401(s)},_onMessageSystem_401:function(e){var i=e.type;if("self"===i||"all"===i)this._logout();else if("provider"===i){var t=s.user();if(t)if(t.op.anonymous)this._logout();else{var n=t.provider,o=e.provider;n&&o&&n.scene===o.scene&&n.id===o.id&&this._logout()}}},_onConnect:function(){if(this._subscribesWaiting={},0===Object.keys(this._subscribesPath).length)this.disconnect();else{for(var s in this._subscribesPath)this._subscribesWaiting[s]=!0;this._doSubscribesWaiting()}},_onDisconnect:function(s){this._subscribesWaiting={},"io server disconnect"!==s&&"transport close"!==s||this.connect()},connect:function(){this._socket&&this._socket.connect()},disconnect:function(){this._socket&&this._socket.disconnect()},reset:function(){var e=this;this._unsubscribesWaiting={},this._unsubscribesWaitingTimeoutId=0,this._unsubscribesWaitingDoing=!1,this._subscribesWaiting={},this._subscribesWaitingTimeoutId=0,this._subscribesWaitingDoing=!1,this._subscribesAll={},this._subscribesPath={},this.disconnect(),this._socket&&(this._socket.off("connect",this._onConnectBind),this._socket.off("disconnect",this._onDisconnectBind),this._socket.off("message",this._onMessageBind),this._socket.off("message-system",this._onMessageSystemBind),this._socket=null);var i=s.user();i&&!i.op.anonymous&&this.subscribe("/a/socketio/messageSystem",(function(s){var i=s.message;e._onMessageSystem(JSON.parse(i.content))}))}};return e._onConnectBind=e._onConnect.bind(e),e._onDisconnectBind=e._onDisconnect.bind(e),e._onMessageBind=e._onMessage.bind(e),e._onMessageSystemBind=e._onMessageSystem.bind(e),s.initialize(e),e};return e})()}));
//# sourceMappingURL=socketio-umd.min.js.map