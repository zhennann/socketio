!function(s,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.socketio=i():s.socketio=i()}(window,(function(){return function(s){var i={};function t(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return s[e].call(n.exports,n,n.exports,t),n.l=!0,n.exports}return t.m=s,t.c=i,t.d=function(s,i,e){t.o(s,i)||Object.defineProperty(s,i,{enumerable:!0,get:e})},t.r=function(s){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},t.t=function(s,i){if(1&i&&(s=t(s)),8&i)return s;if(4&i&&"object"==typeof s&&s&&s.__esModule)return s;var e=Object.create(null);if(t.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:s}),2&i&&"string"!=typeof s)for(var n in s)t.d(e,n,function(i){return s[i]}.bind(null,n));return e},t.n=function(s){var i=s&&s.__esModule?function(){return s.default}:function(){return s};return t.d(i,"a",i),i},t.o=function(s,i){return Object.prototype.hasOwnProperty.call(s,i)},t.p="",t(t.s=0)}([function(s,i,t){"use strict";t.r(i),i.default=function(s){var i={_socket:null,_subscribeCounter:0,_subscribesAll:{},_subscribesPath:{},_subscribesWaitingTimeoutId:0,_subscribesWaitingDoing:!1,_subscribesWaiting:{},_unsubscribesWaitingTimeoutId:0,_unsubscribesWaitingDoing:!1,_unsubscribesWaiting:{},subscribe:function(s,i,t,e){e=e||{};var n=this._getSocket();n.connected||n.connect();var c=++this._subscribeCounter;this._subscribesAll[c]={path:s,cbMessage:i,cbSubscribed:t,options:e};var r=this._subscribesPath[s],b=!1;return r||(r=this._subscribesPath[s]={scene:e.scene,items:{}},b=!0,delete this._unsubscribesWaiting[s]),r.items[c]=!0,n.connected&&(b?(this._subscribesWaiting[s]=!0,this._doSubscribesWaiting()):this._subscribesWaiting[s]||t&&t()),c},unsubscribe:function(s){var i=this._subscribesAll[s];if(i){var t=this._subscribesPath[i.path];if(t&&(delete t.items[s],0===Object.keys(t.items).length&&(delete this._subscribesPath[i.path],delete this._subscribesWaiting[i.path],t.socketId&&(this._unsubscribesWaiting[i.path]={scene:t.scene,socketId:t.socketId},this._doUnsubscribesWaiting()))),delete this._subscribesAll[s],0===Object.keys(this._subscribesAll).length)this._getSocket().disconnect()}},_doSubscribesWaiting:function(){var i=this;if(!this._subscribesWaitingDoing&&0===this._subscribesWaitingTimeoutId&&0!==Object.keys(this._subscribesWaiting).length&&this._socket.connected){var t=[];for(var e in this._subscribesWaiting){var n=this._subscribesPath[e];n&&t.push({path:e,scene:n.scene})}this._subscribesWaitingDoing=!0,s.subscribe({subscribes:t,socketId:this._socket.id}).then((function(){var s=!0,e=!1,n=void 0;try{for(var c,r=t[Symbol.iterator]();!(s=(c=r.next()).done);s=!0){var b=c.value;delete i._subscribesWaiting[b.path];var u=i._subscribesPath[b.path];if(u)for(var o in u.socketId=i._socket.id,u.items){var a=i._subscribesAll[o];a&&a.cbSubscribed&&a.cbSubscribed()}}}catch(s){e=!0,n=s}finally{try{!s&&r.return&&r.return()}finally{if(e)throw n}}i._subscribesWaitingDoing=!1,i._doSubscribesWaiting()})).catch((function(){i._subscribesWaitingDoing=!1,i._subscribesWaitingTimeoutId=window.setTimeout((function(){i._subscribesWaitingTimeoutId=0,i._doSubscribesWaiting()}),2e3)}))}},_doUnsubscribesWaiting:function(){var i=this;if(!this._unsubscribesWaitingDoing&&0===this._unsubscribesWaitingTimeoutId&&0!==Object.keys(this._unsubscribesWaiting).length){var t=[];for(var e in this._unsubscribesWaiting){if(this._subscribesPath[e])delete this._unsubscribesWaiting[e];else{var n=this._unsubscribesWaiting[e];t.push({path:e,scene:n.scene,socketId:n.socketId})}}this._unsubscribesWaitingDoing=!0,s.unsubscribe({subscribes:t}).then((function(){var s=!0,e=!1,n=void 0;try{for(var c,r=t[Symbol.iterator]();!(s=(c=r.next()).done);s=!0){var b=c.value;delete i._unsubscribesWaiting[b.path]}}catch(s){e=!0,n=s}finally{try{!s&&r.return&&r.return()}finally{if(e)throw n}}i._unsubscribesWaitingDoing=!1,i._doUnsubscribesWaiting()})).catch((function(){i._unsubscribesWaitingDoing=!1,i._unsubscribesWaitingTimeoutId=window.setTimeout((function(){i._unsubscribesWaitingTimeoutId=0,i._doUnsubscribesWaiting()}),2e3)}))}},_getSocket:function(){return this._socket||(this._socket=s.socket(),this._socket.on("connect",this._onConnect.bind(this)),this._socket.on("disconnect",this._onDisconnect.bind(this)),this._socket.on("message",this._onMessage.bind(this))),this._socket},_onMessage:function(s){var i=this._subscribesPath[s.path];if(i)for(var t in i.items){var e=this._subscribesAll[t];e&&e.cbMessage&&e.cbMessage({message:s.message})}},_onConnect:function(){if(this._subscribesWaiting={},0===Object.keys(this._subscribesPath).length)this._socket.disconnect();else{for(var s in this._subscribesPath)this._subscribesWaiting[s]=!0;this._doSubscribesWaiting()}},_onDisconnect:function(s){this._subscribesWaiting={},"io server disconnect"===s&&this._socket.connect()},reset:function(){this._unsubscribesWaiting={},this._subscribesWaiting={},this._subscribesAll={},this._subscribesPath={},this._socket&&this._socket.disconnect()}};return s.initialize(i),i}}])}));
//# sourceMappingURL=socketio.min.js.map